---
import Layout from '../layouts/Layout.astro';
import PreviewWrapper from '../components/PreviewWrapper';
import HomeContent from '../components/HomeContent';
import { craftClient } from '../lib/craft';
import { HOME_QUERY } from '../queries/home.mjs';
import { getPreviewStatus } from '../lib/preview';

const { isPreview, previewToken } = getPreviewStatus(Astro.url);

let pageData = null;
let error = null;

try {
  const response = await craftClient.query(HOME_QUERY);
  pageData = response.entry;
} catch (e) {
  console.error('Error fetching data:', e);
  error = e.message;
}
---

<Layout title={pageData?.title || 'Home'}>
  {error && (
    <div class="error-message">
      <p>Error loading page: {error}</p>
    </div>
  )}

  {isPreview ? (
    <PreviewWrapper 
      client:only="react"
      query={HOME_QUERY}
    />
  ) : (
    <HomeContent client:load data={pageData} />
  )}
</Layout>

<style>
  .error-message {
    color: red;
    padding: 1rem;
    margin: 1rem 0;
    border: 1px solid red;
    border-radius: 4px;
  }

  :global(.home-content) {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  :global(.hero-image) {
    width: 100%;
    height: auto;
    margin: 2rem 0;
  }

  :global(.content) {
    margin-top: 2rem;
  }
</style>

